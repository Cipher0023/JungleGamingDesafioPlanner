<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test - Notifications Service</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
      padding: 30px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .status-section {
      margin-bottom: 25px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .status-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }

    .status-indicator.connected {
      background-color: #4caf50;
    }

    .status-indicator.disconnected {
      background-color: #f44336;
      animation: none;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .status-text {
      font-size: 14px;
      color: #666;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 25px;
    }

    button {
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f44336;
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #da190b;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
    }

    .btn-success {
      background: #4caf50;
      color: white;
      grid-column: 1 / -1;
    }

    .btn-success:hover:not(:disabled) {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .messages-section {
      margin-top: 25px;
    }

    .messages-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .messages-container {
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      height: 300px;
      overflow-y: auto;
      padding: 12px;
    }

    .message {
      margin-bottom: 12px;
      padding: 10px;
      background: white;
      border-left: 3px solid #667eea;
      border-radius: 4px;
      font-size: 13px;
      line-height: 1.4;
    }

    .message.sent {
      border-left-color: #4caf50;
      background: #f1f8f4;
    }

    .message.received {
      border-left-color: #667eea;
      background: #f3f5ff;
    }

    .message.error {
      border-left-color: #f44336;
      background: #fef5f5;
      color: #c62828;
    }

    .message-time {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }

    .clear-btn {
      margin-top: 10px;
      width: 100%;
      padding: 8px;
      background: #e0e0e0;
      color: #333;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .clear-btn:hover {
      background: #d0d0d0;
    }

    .client-id {
      font-family: 'Courier New', monospace;
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîî WebSocket Test</h1>
    <p class="subtitle">Notifications Service</p>

    <div class="status-section">
      <div class="status-label">
        <span class="status-indicator disconnected" id="statusIndicator"></span>
        Status da Conex√£o
      </div>
      <div class="status-text">
        <span id="statusText">Desconectado</span>
        <br>
        <span id="clientIdText" style="margin-top: 8px; display: block; font-size: 12px; color: #999;"></span>
      </div>
    </div>

    <div class="input-group">
      <label for="serverUrl">URL do Servidor</label>
      <input type="text" id="serverUrl" value="http://localhost:3000" placeholder="http://localhost:3000">
    </div>

    <div class="button-group">
      <button class="btn-primary" id="connectBtn" onclick="connect()">Conectar</button>
      <button class="btn-secondary" id="disconnectBtn" onclick="disconnect()" disabled>Desconectar</button>
    </div>

    <div class="input-group">
      <label for="messageInput">Mensagem de Teste</label>
      <input type="text" id="messageInput" placeholder="Digite uma mensagem..." disabled>
    </div>

    <div class="button-group">
      <button class="btn-primary" id="sendTestBtn" onclick="sendTestMessage()" disabled>Enviar Teste</button>
      <button class="btn-primary" id="broadcastBtn" onclick="sendBroadcast()" disabled>Broadcast</button>
      <button class="btn-success" id="pingBtn" onclick="sendPing()" disabled>Ping</button>
    </div>

    <div class="messages-section">
      <div class="messages-title">Mensagens</div>
      <div class="messages-container" id="messagesContainer"></div>
      <button class="clear-btn" onclick="clearMessages()">Limpar Mensagens</button>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    let socket = null;

    function updateStatus(connected) {
      const indicator = document.getElementById('statusIndicator');
      const statusText = document.getElementById('statusText');
      const connectBtn = document.getElementById('connectBtn');
      const disconnectBtn = document.getElementById('disconnectBtn');
      const messageInput = document.getElementById('messageInput');
      const sendTestBtn = document.getElementById('sendTestBtn');
      const broadcastBtn = document.getElementById('broadcastBtn');
      const pingBtn = document.getElementById('pingBtn');

      if (connected) {
        indicator.className = 'status-indicator connected';
        statusText.textContent = '‚úì Conectado';
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
        messageInput.disabled = false;
        sendTestBtn.disabled = false;
        broadcastBtn.disabled = false;
        pingBtn.disabled = false;
      } else {
        indicator.className = 'status-indicator disconnected';
        statusText.textContent = '‚úó Desconectado';
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
        messageInput.disabled = true;
        sendTestBtn.disabled = true;
        broadcastBtn.disabled = true;
        pingBtn.disabled = true;
        document.getElementById('clientIdText').textContent = '';
      }
    }

    function addMessage(text, type = 'received') {
      const container = document.getElementById('messagesContainer');
      const message = document.createElement('div');
      message.className = `message ${type}`;
      const time = new Date().toLocaleTimeString('pt-BR');
      message.innerHTML = `${text}<div class="message-time">${time}</div>`;
      container.appendChild(message);
      container.scrollTop = container.scrollHeight;
    }

    function clearMessages() {
      document.getElementById('messagesContainer').innerHTML = '';
    }

    function connect() {
      const serverUrl = document.getElementById('serverUrl').value;
      
      if (!serverUrl) {
        addMessage('‚ùå URL do servidor √© obrigat√≥ria', 'error');
        return;
      }

      socket = io(serverUrl, {
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 5000,
        reconnectionAttempts: 5,
      });

      socket.on('connect', () => {
        addMessage('‚úì Conectado ao servidor WebSocket', 'received');
        document.getElementById('clientIdText').innerHTML = `ID: <span class="client-id">${socket.id}</span>`;
        updateStatus(true);
      });

      socket.on('disconnect', () => {
        addMessage('‚úó Desconectado do servidor', 'error');
        updateStatus(false);
      });

      socket.on('test-response', (data) => {
        addMessage(`üì® Resposta de Teste: ${JSON.stringify(data)}`, 'received');
      });

      socket.on('broadcast-response', (data) => {
        addMessage(`üì¢ Broadcast Recebido: ${JSON.stringify(data)}`, 'received');
      });

      socket.on('pong', (data) => {
        addMessage(`üèì Pong: ${JSON.stringify(data)}`, 'received');
      });

      socket.on('connect_error', (error) => {
        addMessage(`‚ùå Erro de Conex√£o: ${error.message}`, 'error');
      });

      socket.on('error', (error) => {
        addMessage(`‚ùå Erro: ${error}`, 'error');
      });
    }

    function disconnect() {
      if (socket) {
        socket.disconnect();
        addMessage('Desconectado manualmente', 'sent');
        updateStatus(false);
      }
    }

    function sendTestMessage() {
      const message = document.getElementById('messageInput').value;
      if (!message) {
        addMessage('‚ùå Digite uma mensagem', 'error');
        return;
      }

      if (socket && socket.connected) {
        socket.emit('test-message', { text: message });
        addMessage(`üì§ Enviado (Teste): ${message}`, 'sent');
        document.getElementById('messageInput').value = '';
      } else {
        addMessage('‚ùå N√£o conectado ao servidor', 'error');
      }
    }

    function sendBroadcast() {
      const message = document.getElementById('messageInput').value;
      if (!message) {
        addMessage('‚ùå Digite uma mensagem', 'error');
        return;
      }

      if (socket && socket.connected) {
        socket.emit('broadcast-message', { text: message });
        addMessage(`üì§ Enviado (Broadcast): ${message}`, 'sent');
        document.getElementById('messageInput').value = '';
      } else {
        addMessage('‚ùå N√£o conectado ao servidor', 'error');
      }
    }

    function sendPing() {
      if (socket && socket.connected) {
        socket.emit('ping');
        addMessage('üì§ Ping enviado', 'sent');
      } else {
        addMessage('‚ùå N√£o conectado ao servidor', 'error');
      }
    }

    // Inicializar status
    updateStatus(false);
  </script>
</body>
</html>
